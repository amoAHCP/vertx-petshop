angular.module("Petstore",[]);var ItemListController=function(e){function r(e){this.product=e;this.amount=1}e.name="AngularJS";e.pets=[];e.test="asdas";e.order={id:3,customer:{firstname:"",lastname:"",email:"",homeAddress:{street1:"",zipcode:"",city:"",country:""}},basket:{basketItems:[]},amount:0};e.orderId="";var t=new WebSocket("ws://jacpfx.org:8080/all");var n=new WebSocket("ws://jacpfx.org:9090/placeOrder");t.onopen=function(){console.log("item WS open")};n.onopen=function(){console.log("order WS open")};n.onmessage=function(t){console.log(t);e.toggleDialog("#waitModal",false);e.orderId=t.data;e.$apply()};t.onmessage=function(t){e.$apply(function(){var n=JSON.parse(t.data);if(n.state=="UPDATE"){n.products.forEach(function(t){e.pets.forEach(function(n){if(n.id==t.id){e.pets.splice(e.pets.indexOf(n),1)}});e.pets.push(t)})}else{e.pets=n.products}})};e.addToBasketAndClose=function(t){e.addToBasket(t);e.hideDetails(t)};e.addToBasket=function(t){var n=false;e.order.basket.basketItems.forEach(function(e){if(e.product===t){e.amount+=1;e.product.amount-=1;n=true}});if(!n){e.pushItem(t);t.amount-=1}};e.newOrder=function(){location.reload()};e.removeOneFromBasket=function(t){var n=e.order.basket.basketItems.indexOf(t);var r=e.order.basket.basketItems[n];if(r.amount==1){e.order.basket.basketItems.splice(n,1);r.product.amount+=1}else{r.amount=r.amount-1;r.product.amount+=1}};e.addOneToBasket=function(t){var n=e.order.basket.basketItems.indexOf(t);var r=e.order.basket.basketItems[n];if(r.product.amount>0){r.amount=r.amount+1;r.product.amount-=1}};e.removeFromBasket=function(t){var n=e.order.basket.basketItems.indexOf(t);e.order.basket.basketItems.splice(n,1);t.product.amount+=t.amount};e.pushItem=function(t){var n=new r(t);e.order.basket.basketItems.push(n)};e.placeOrder=function(){e.toggleDialog("#customerModal",false);n.send(JSON.stringify(e.order));e.toggleDialog("#waitModal",true)};e.showCheckout=function(){e.toggleDialog("#customerModal",true)};e.showDetails=function(t){e.toggleDialog("#"+t.id,true)};e.hideDetails=function(t){e.toggleDialog("#"+t.id,false)};e.toggleDialog=function(e,t){$(e).modal(t?"show":"hide")};e.total=function(){var t=0;e.order.basket.basketItems.forEach(function(e){t+=e.amount*e.product.price});e.amount=t;return e.amount}}